{"version":3,"sources":["datavis.min.js"],"names":["jQuery","document","ready","$","each","id","$id","margin","numFormat","d3","format","width","shift","x","profInRowMin","y","maxFeature1","data","maxFeature2","profInRow","Math","max","floor","screenWidth","minWidth","smallBp","masterunit","moreHorUnits","dataStart","dataEnd","labels","legendLabelDistance","icons","except","exceptLang","exceptHeightMulti","height","yPos","d","i","gutter","xPos","fAttr","sel","shape","attr","parseFloat","selectAll","nodes","getAttribute","svg","editors","articles","views","tooltip","container","select","checks","aspect","mappedData","map","p","index","unitSum","remain","specHorUnits","rows","ceil","unitArray","h","push","value","slice","length","Rows","ddata","maxRows","editorScale","scaleLinear","domain","range","articleScale","viewsUnitScale","viewsYScale","viewsXScale","horUnits","minHeight","append","window","resize","targetWidth","node","getBoundingClientRect","call","g","join","e","normalPosX","exceptPosX","posX","smallPosX","a","ix","ry","normalPosY","exceptPosY","transX","transY","offset","labelX","labelY","g1","text","g2","style","borderHeight","endX","v","datalabelText","datalabelIcons","d0","aObj","vx1","vxCenter","vy1","lastRowOverHalf","customLegend","y2","class","highlight","name","marginBottom","dd","textWidth","this","getBBox","ltext","on","_","hover","click","checkBoxStates","transition","editXPos","artXPos","artW","posInRow","min","size","shiftSmScreens","hoverLabels","round","y1","labelPos","is","$elem","fadeIn","fadeOut","addVis","dataProfiles","lineChart","isMobile","origWidth","strokeWidth","circleDiameter","accentColorClass","timeFormatPrefs","month","day","year","parseTimeFormat","timeParse","dataRaw","wp","date","callout","evnt","rect","t","split","bbox","w","ttipMar","ticks","scaleTime","nice","extent","axisBottom","timeMonth","tickFormat","timeFormat","remove","axisLeft","tickSize","datum","line","filter","event","enter","hoverD","mx","bisect","bisector","left","invert","b","bisectDate","mouse","context","toLocaleString","undefined","css"],"mappings":"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","file":"../datavis.min.js","sourcesContent":["/* global d3 */\n/* eslint-disable no-magic-numbers */\n\njQuery(document).ready(function($) {\n\n\t'use strict';\n\n\tfunction dataProfiles(id) {\n\t\tvar $id = $(\"#\" + id),\n\t\t\tmargin = 10,\n\t\t\tstrokeW = 2,\n\t\t\tnumFormat = d3.format(\",\"),\n\t\t\twidth = $id.width(),\n\t\t\tprofInRowMin = 2,\n\t\t\tidealX = 190,\n\t\t\tshift = { x: width < profInRowMin*idealX ? width/2 - margin : idealX, y: 125 },\n\t\t\tmaxFeature1 = $id.data(\"max-feature-1\") ? $id.data(\"max-feature-1\") : 90,\n\t\t\tmaxFeature2 = $id.data(\"max-feature-2\") ? $id.data(\"max-feature-2\") : 90,\n\t\t\tprofInRow = Math.max(Math.floor(width / shift.x), profInRowMin),\n\t\t\tscreenWidth = $(\"body\").width(),\n\t\t\tminWidth = idealX * profInRow,\n\t\t\tsmallBp = 500, // per _variables.scss\n\t\t\tmasterunit = $id.data(\"chart-masterunit\") ? $id.data(\"chart-masterunit\") : 500000,\n\t\t\thorUnits = 5,\n\t\t\tmoreHorUnits = width < minWidth ? 24 : 30,\n\t\t\tdata = $id.data(\"chart-raw\"),\n\t\t\tdataStart = $id.data(\"slice-start\"),\n\t\t\tdataEnd = $id.data(\"slice-end\"),\n\t\t\t// This is setup so properties/labels don't matter\n\t\t\t// But labels map to this order: circle, rectangle, ellipses\n\t\t\tlabels = $id.data(\"chart-labels\"),\n\t\t\tlegendLabelDistance = 45,\n\t\t\ticons = $id.data(\"chart-icons\"),\n\t\t\texcept = $id.data(\"chart-except\"),\n\t\t\texceptI = 0,\n\t\t\texceptLang = except ? data[labels[exceptI]] : \"\",\n\t\t\texceptHeightMulti = 3.5,\n\t\t\theight = except ? shift.y * exceptHeightMulti : yPos(null, dataEnd - dataStart -1) + shift.y;\n\n\t\tfunction yPos(d, i) {\n\t\t\tvar gutter = margin * 6,\n\t\t\t\ttopmargin = except ? 0 : margin * 5;\n\t\t\treturn topmargin + (shift.y + gutter) * Math.floor(i / profInRow);\n\t\t}\n\n\t\tfunction xPos(d, i) {\n\t\t\treturn i % profInRow * shift.x;\n\t\t}\n\n\t\tfunction fAttr(sel, shape, i, attr) {\n\t\t\treturn parseFloat(sel.selectAll(shape).nodes()[i].getAttribute(attr));\n\t\t}\n\n\t\tfunction addVis() {\n\t\t\tif (!data) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tfunction editorsConstruct(g) {\n\t\t\t\treturn g\n\t\t\t\t\t.attr(\"transform\", \"translate(\" + margin + \",\" + margin + \")\")\n\t\t\t\t\t.attr(\"class\", \"profile-feature1\")\n\t\t\t\t\t.selectAll(\"circle\")\n\t\t\t\t\t.data(ddata)\n\t\t\t\t\t.join(\"circle\")\n\t\t\t\t\t.attr(\"cx\", function(d, i) {return except ? xPos(d, i) + Math.max(width/4, editorScale(d[labels[1]]) + margin) : xPos(d, i) + editorScale(d[labels[1]])})\n\t\t\t\t\t.attr(\"cy\", function(d, i) {return yPos(d, i) + editorScale(d[labels[1]])})\n\t\t\t\t\t.attr(\"r\", function(d) {return editorScale(d[labels[1]])})\n\t\t\t}\n\n\t\t\tfunction articlesConstruct(g, e) {\n\t\t\t\treturn g\n\t\t\t\t\t.attr(\"transform\", \"translate(\" + margin + \",\" + margin + \")\")\n\t\t\t\t\t.attr(\"class\", \"profile-feature2\")\n\t\t\t\t\t.selectAll(\"rect\")\n\t\t\t\t\t.data(ddata)\n\t\t\t\t\t.join(\"rect\")\n\t\t\t\t\t.attr(\"x\", function(d, i) {\n\t\t\t\t\t\tvar normalPosX = fAttr(e, \"circle\", i, \"cx\") + fAttr(e, \"circle\", i, \"r\") + margin/2,\n\t\t\t\t\t\t\texceptPosX = width*0.4 + (width/2-articleScale(d[labels[2]])*0.75)/2,\n\t\t\t\t\t\t\tposX = except ? exceptPosX : normalPosX,\n\t\t\t\t\t\t\tsmallPosX = fAttr(e, \"circle\", i, \"cx\") + fAttr(e, \"circle\", i, \"r\") + margin * 3;\n\t\t\t\t\t\treturn width < minWidth && except ? smallPosX : posX;\n\t\t\t\t\t})\n\t\t\t\t\t.attr(\"y\", function(d, i) {return yPos(d, i)})\n\t\t\t\t\t.attr(\"width\", function(d) {return articleScale(d[labels[2]])*0.75})\n\t\t\t\t\t.attr(\"height\", function(d) {return articleScale(d[labels[2]])})\n\t\t\t\t\t.attr(\"rx\", function(d) {return articleScale(d[labels[2]])*0.08})\n\t\t\t\t\t.attr(\"ry\", function(d) {return articleScale(d[labels[2]])*0.08});\n\t\t\t}\n\n\t\t\tfunction viewsConstruct(g, e, a) {\n\t\t\t\tg.attr(\"class\", \"profile-feature3\");\n\t\t\t\t/* eslint-disable no-loop-func, one-var */\n\t\t\t\tfor (var ix = 0; ix < ddata.length; ix++) {\n\t\t\t\t\tvar ry = viewsUnitScale(masterunit) / 3 * 2,\n\t\t\t\t\t\tnormalPosX = fAttr(a, \"rect\", ix, \"x\") + fAttr(a, \"rect\", ix, \"width\") + margin,\n\t\t\t\t\t\tnormalPosY = fAttr(a, \"rect\", ix, \"y\") + ry,\n\t\t\t\t\t\texceptPosX = (width - viewsXScale(moreHorUnits)) / 2, // center\n\t\t\t\t\t\texceptPosY = fAttr(e, \"circle\", ix, \"cx\") + fAttr(e, \"circle\", ix, \"r\") + legendLabelDistance + margin * 2,\n\t\t\t\t\t\ttransX = except ? exceptPosX : normalPosX,\n\t\t\t\t\t\ttransY = except ? exceptPosY : normalPosY;\n\n\t\t\t\t\tg\n\t\t\t\t\t\t.append(\"g\")\n\t\t\t\t\t\t.attr(\"class\", \"viewsContainer\")\n\t\t\t\t\t\t.attr(\"transform\", \"translate(\" + margin + \",\" + margin + \")\")\n\t\t\t\t\t\t.selectAll(\"ellipse\")\n\t\t\t\t\t\t.data(ddata[ix].unitArray)\n\t\t\t\t\t\t.join(\"ellipse\")\n\t\t\t\t\t\t.attr(\"class\", \"views-\" + ix)\n\t\t\t\t\t\t.attr(\"cx\", function(d) {return transX + viewsXScale(d.x)})\n\t\t\t\t\t\t.attr(\"cy\", function(d) {return transY + viewsYScale(d.y)})\n\t\t\t\t\t\t.attr(\"rx\", function(d) {return viewsUnitScale(d.value)})\n\t\t\t\t\t\t.attr(\"ry\", function(d) {return viewsUnitScale(d.value)/3*2});\n\t\t\t\t\t/* eslint-disable no-loop-func, one-var */\n\t\t\t\t}\n\n\t\t\t\treturn g;\n\t\t\t}\n\n\t\t\tfunction labelConstruct(g, e, offset) {\n\t\t\t\tvar labelX = except ? margin*exceptHeightMulti + margin : margin * 2,\n\t\t\t\t\tlabelY = except ? height - margin : shift.y*0.75 + margin;\n\t\t\t\treturn g\n\t\t\t\t\t.call(function(g1) {\n\t\t\t\t\t\treturn g1\n\t\t\t\t\t\t\t.append(\"g\")\n\t\t\t\t\t\t\t.attr(\"class\", \"main-labels\")\n\t\t\t\t\t\t\t.selectAll(\"text\")\n\t\t\t\t\t\t\t.data(ddata)\n\t\t\t\t\t\t\t.join(\"text\")\n\t\t\t\t\t\t\t.attr(\"text-anchor\", \"start\")\n\t\t\t\t\t\t\t.attr(\"dy\", -5) // create some padding at the bottom\n\t\t\t\t\t\t\t.attr(\"x\", function(d, i) {return screenWidth < smallBp ? xPos(d, i) + margin : xPos(d, i) + labelX})\n\t\t\t\t\t\t\t.attr(\"y\", function(d, i) {return yPos(d, i) + labelY})\n\t\t\t\t\t\t\t.text(function(d) {return labels.length > 4 ? d[labels[4]] : d[labels[0]] })\n\t\t\t\t\t})\n\t\t\t\t\t.call(function(g2) {\n\t\t\t\t\t\treturn g2\n\t\t\t\t\t\t\t.append(\"g\")\n\t\t\t\t\t\t\t.attr(\"class\", \"main-label-ranks\")\n\t\t\t\t\t\t\t.style(\"display\", \"none\")\n\t\t\t\t\t\t\t.selectAll(\"text\")\n\t\t\t\t\t\t\t.data(ddata)\n\t\t\t\t\t\t\t.join(\"text\")\n\t\t\t\t\t\t\t.attr(\"text-anchor\", \"start\")\n\t\t\t\t\t\t\t.attr(\"dy\", -30) // above mainlabel\n\t\t\t\t\t\t\t.attr(\"x\", function(d, i) {return screenWidth < smallBp ? xPos(d, i) + margin : xPos(d, i) + labelX})\n\t\t\t\t\t\t\t.attr(\"y\", function(d, i) {return yPos(d, i) + labelY})\n\t\t\t\t\t\t\t.text(function(d, i) {return i + 1 + offset});\n\t\t\t\t\t})\n\t\t\t}\n\n\n\t\t\tfunction borderleft(g) {\n\t\t\t\tvar borderHeight = except ? height : shift.y - margin,\n\t\t\t\t\tendX = except ? margin * exceptHeightMulti : margin;\n\t\t\t\treturn g\n\t\t\t\t\t.attr(\"stroke-width\", strokeW)\n\t\t\t\t\t.attr(\"class\", \"borderleft\")\n\t\t\t\t\t.selectAll(\"line\")\n\t\t\t\t\t.data(ddata)\n\t\t\t\t\t.join(\"line\")\n\t\t\t\t\t.attr(\"x1\", function(d, i) {return xPos(d, i) + strokeW})\n\t\t\t\t\t.attr(\"x2\", function(d, i) {return screenWidth < smallBp ? xPos(d, i) + strokeW : xPos(d, i) + endX})\n\t\t\t\t\t.attr(\"y1\", function(d, i) {return yPos(d, i)})\n\t\t\t\t\t.attr(\"y2\", function(d, i) {return yPos(d, i) + borderHeight});\n\t\t\t}\n\n\t\t\tfunction legendConstruct(g, e, a, v) {\n\t\t\t\tvar datalabelText,\n\t\t\t\t\tdatalabelIcons,\n\t\t\t\t\td0 = ddata[0],\n\t\t\t\t\taObj = {\n\t\t\t\t\t\tx: fAttr(a, \"rect\", 0, \"x\"),\n\t\t\t\t\t\ty: fAttr(a, \"rect\", 0, \"y\"),\n\t\t\t\t\t\tw: fAttr(a, \"rect\", 0, \"width\"),\n\t\t\t\t\t\th: fAttr(a, \"rect\", 0, \"height\"),\n\t\t\t\t\t},\n\t\t\t\t\tvx1 = fAttr(v, \"ellipse\", moreHorUnits-1, \"cx\"),\n\t\t\t\t\tvxCenter = fAttr(v, \"ellipse\", Math.floor(moreHorUnits/2) - 1, \"cx\"),\n\t\t\t\t\tvy1 = fAttr(v, \"ellipse\", moreHorUnits * (d0.Rows - 1), \"cy\"),\n\t\t\t\t\tlastRowOverHalf = moreHorUnits * d0.Rows % d0.unitArray.length > Math.ceil(moreHorUnits/2) + 1,\n\t\t\t\t\tmarginBottom = 60,\n\t\t\t\t\tcustomLegend = [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tx: fAttr(e, \"circle\", 0, \"cx\"),\n\t\t\t\t\t\t\ty: fAttr(e, \"circle\", 0, \"cy\") + fAttr(e, \"circle\", 0, \"r\") - margin,\n\t\t\t\t\t\t\ty2: height - marginBottom,\n\t\t\t\t\t\t\th: legendLabelDistance,\n\t\t\t\t\t\t\tclass: 1,\n\t\t\t\t\t\t\thighlight: true,\n\t\t\t\t\t\t\tname: [numFormat(d0[labels[1]]) + \" \" + labels[1]]\n\t\t\t\t\t\t}, {\n\t\t\t\t\t\t\tx: aObj.x + aObj.w * 0.5,\n\t\t\t\t\t\t\ty: aObj.y + aObj.h - margin,\n\t\t\t\t\t\t\ty2: height - marginBottom,\n\t\t\t\t\t\t\th: legendLabelDistance,\n\t\t\t\t\t\t\tclass: 2,\n\t\t\t\t\t\t\thighlight: true,\n\t\t\t\t\t\t\tname: [numFormat(d0[labels[2]]) + \" \" + labels[2]]\n\t\t\t\t\t\t}, {\n\t\t\t\t\t\t\tx: vxCenter,\n\t\t\t\t\t\t\ty: lastRowOverHalf ? vy1 : vy1 + margin,\n\t\t\t\t\t\t\ty2: height - marginBottom * 1.5,\n\t\t\t\t\t\t\th: legendLabelDistance,\n\t\t\t\t\t\t\tclass: 3,\n\t\t\t\t\t\t\thighlight: true,\n\t\t\t\t\t\t\tname: [numFormat(d0[labels[3]]) + \" \" + labels[3]]\n\t\t\t\t\t\t}, {\n\t\t\t\t\t\t\tx: vx1,\n\t\t\t\t\t\t\ty: vy1 - viewsUnitScale.range()[1] * 2,\n\t\t\t\t\t\t\ty2: height - marginBottom * 2,\n\t\t\t\t\t\t\th: legendLabelDistance/2,\n\t\t\t\t\t\t\tclass: 3,\n\t\t\t\t\t\t\thighlight: false,\n\t\t\t\t\t\t\tname: [numFormat(masterunit), labels[3]]\n\t\t\t\t\t\t}\n\t\t\t\t\t];\n\n\t\t\t\tg\n\t\t\t\t\t.append(\"g\")\n\t\t\t\t\t.attr(\"transform\", \"translate(\" + margin + \",\" + margin + \")\")\n\t\t\t\t\t.attr(\"class\", \"data-label-lines\")\n\t\t\t\t\t.selectAll(\"line\")\n\t\t\t\t\t.data(customLegend)\n\t\t\t\t\t.join(\"line\")\n\t\t\t\t\t.attr(\"class\", function(d) {return \"profile-feature\" + d.class})\n\t\t\t\t\t.attr(\"x1\", function(d) {return d.x})\n\t\t\t\t\t.attr(\"x2\", function(d) {return d.x})\n\t\t\t\t\t.attr(\"y1\", function(d) {return d.y})\n\t\t\t\t\t.attr(\"y2\", function(d) {return d.y + d.h})\n\t\t\t\t\t.attr(\"stroke-dasharray\", function(d) {return d.highlight ? \"\" : margin/3 + \",\" + margin/4});\n\n\t\t\t\tdatalabelText = g\n\t\t\t\t\t.append(\"g\")\n\t\t\t\t\t.attr(\"transform\", \"translate(\" + margin + \",\" + margin + \")\")\n\t\t\t\t\t.attr(\"class\", \"data-label-text\")\n\t\t\t\t\t.selectAll(\"text\")\n\t\t\t\t\t.data(customLegend)\n\t\t\t\t\t.join(\"text\")\n\t\t\t\t\t.attr(\"class\", function(d) {return \"profile-feature\" + d.class})\n\t\t\t\t\t.attr(\"x\", function(d) {return d.x})\n\t\t\t\t\t.attr(\"y\", function(d) {return d.y + d.h})\n\t\t\t\t\t.attr(\"dy\", margin * 1.5)\n\t\t\t\t\t.attr(\"stroke-width\", 0)\n\t\t\t\t\t.attr(\"font-weight\", function(d) {return d.highlight ? \"bold\" : \"normal\"})\n\t\t\t\t\t.attr(\"text-anchor\", \"middle\");\n\n\t\t\t\tdatalabelText\n\t\t\t\t\t.append(\"tspan\")\n\t\t\t\t\t.attr(\"x\", function(d) {return d.x})\n\t\t\t\t\t.attr(\"dx\", viewsUnitScale.range()[1])\n\t\t\t\t\t.text(function(d) {return d.name[0]});\n\n\t\t\t\tdatalabelText\n\t\t\t\t\t.append(\"tspan\")\n\t\t\t\t\t.attr(\"x\", function(d) {return d.x})\n\t\t\t\t\t.attr(\"dy\", 16)\n\t\t\t\t\t.attr(\"dx\", viewsUnitScale.range()[1])\n\t\t\t\t\t.text(function(d) {return d.name[1]});\n\n\t\t\t\tdatalabelIcons = g\n\t\t\t\t\t.append(\"g\")\n\t\t\t\t\t.attr(\"transform\", \"translate(\" + margin + \",\" + margin + \")\")\n\t\t\t\t\t.attr(\"class\", \"data-label-icon\");\n\n\t\t\t\tdatalabelText.selectAll(\"tspan\").each(function(dd, i) {\n\t\t\t\t\tif (i === 0 && dd.highlight) {\n\t\t\t\t\t\tvar textWidth = this.getBBox().width;\n\t\t\t\t\t\tdatalabelIcons.call(function(ltext) {\n\t\t\t\t\t\t\treturn ltext\n\t\t\t\t\t\t\t\t.append(\"image\")\n\t\t\t\t\t\t\t\t.attr(\"class\", \"profile-feature\" + dd.class)\n\t\t\t\t\t\t\t\t.attr(\"xlink:href\", icons[dd.class - 1])\n\t\t\t\t\t\t\t\t.attr(\"width\", margin * 1.1)\n\t\t\t\t\t\t\t\t.attr(\"height\", margin * 1.1)\n\t\t\t\t\t\t\t\t.attr(\"x\", dd.x - textWidth/2 - margin)\n\t\t\t\t\t\t\t\t.attr(\"y\", dd.y + dd.h + margin * 0.5);\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\treturn g;\n\t\t\t}\n\n\t\t\tfunction mappedViewsData(_data) {\n\t\t\t\treturn _data.map(function(p, index) {\n\t\t\t\t\tvar unitSum = Math.floor(p[labels[3]]/masterunit),\n\t\t\t\t\t\tremain = p[labels[3]] % masterunit,\n\t\t\t\t\t\tspecHorUnits = index === exceptI ? moreHorUnits : horUnits,\n\t\t\t\t\t\trows = Math.ceil(unitSum/specHorUnits);\n\t\t\t\t\tp.unitArray = [];\n\t\t\t\t\tfor (var i = 0; i < rows; i++) { // eslint-disable-line one-var\n\t\t\t\t\t\tfor (var h = 0; h < specHorUnits; h++) { // eslint-disable-line one-var\n\t\t\t\t\t\t\tp.unitArray.push({ x: h, y: i, value: masterunit })\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tp.unitArray = p.unitArray.slice(0, unitSum); // only take the amount of spaces needed\n\t\t\t\t\tp.unitArray[p.unitArray.length-1].value = remain; // last space is the remainder, not a full masterunit\n\t\t\t\t\tp.Rows = rows;\n\t\t\t\t\treturn p;\n\t\t\t\t})\n\t\t\t}\n\n\t\t\tfunction hover(g, index, e, a, v) { //eslint-disable-line max-params\n\t\t\t\tif (index === null) return g\n\t\t\t\t\t.transition()\n\t\t\t\t\t.attr(\"opacity\", 0)\n\t\t\t\t\t.transition()\n\t\t\t\t\t.style(\"display\", \"none\");\n\n\t\t\t\tvar editXPos = fAttr(e, \"circle\", index, \"cx\"),\n\t\t\t\t\tartXPos = fAttr(a, \"rect\", index, \"x\"),\n\t\t\t\t\tartW = fAttr(a, \"rect\", index, \"width\"),\n\t\t\t\t\tposInRow = fAttr(v, \".views-\" + index, Math.min(Math.floor(horUnits/2), ddata[index].unitArray.length - 1), \"cx\") + margin,\n\t\t\t\t\tsize = margin,\n\t\t\t\t\tshiftSmScreens = width < minWidth ? 20 : 0,\n\t\t\t\t\thoverLabels = [{\n\t\t\t\t\t\tvalue: ddata[index][labels[1]],\n\t\t\t\t\t\tx: Math.round(editXPos + margin),\n\t\t\t\t\t\ty1: yPos(null, index) + margin,\n\t\t\t\t\t\th: 36,\n\t\t\t\t\t\tlabelPos: [editXPos, yPos(null, index) - 36]\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tvalue: ddata[index][labels[2]],\n\t\t\t\t\t\tx: Math.round(artXPos + margin + artW/2),\n\t\t\t\t\t\ty1: yPos(null, index) + margin,\n\t\t\t\t\t\th: 21,\n\t\t\t\t\t\tlabelPos: [artXPos + artW / 2, yPos(null, index) - 21]\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tvalue: ddata[index][labels[3]],\n\t\t\t\t\t\tx: Math.round(posInRow),\n\t\t\t\t\t\ty1: yPos(null, index) + viewsUnitScale.range()[1]*2,\n\t\t\t\t\t\th: 6,\n\t\t\t\t\t\tlabelPos: [posInRow - margin - shiftSmScreens, yPos(null, index) - 6]\n\t\t\t\t\t}\n\t\t\t\t\t];\n\n\t\t\t\tg\n\t\t\t\t\t.transition()\n\t\t\t\t\t.attr(\"opacity\", 1)\n\t\t\t\t\t.style(\"display\", null)\n\t\t\t\t\t.style(\"pointer-events\", \"none\")\n\n\t\t\t\tg.selectAll(\"line\")\n\t\t\t\t\t.data(hoverLabels)\n\t\t\t\t\t.join(\"line\")\n\t\t\t\t\t.attr(\"class\", \"hover-label-lines\")\n\t\t\t\t\t.attr(\"x1\", function(d) {return d.x})\n\t\t\t\t\t.attr(\"x2\", function(d) {return d.x})\n\t\t\t\t\t.attr(\"y1\", function(d) {return d.y1})\n\t\t\t\t\t.attr(\"y2\", function(d) {return d.y1 - d.h})\n\t\t\t\t\t.style(\"display\", function(d, i) {return checks[i].is(\":checked\") ? \"block\" : \"none\" });\n\n\t\t\t\tg.selectAll(\"text\")\n\t\t\t\t\t.data(hoverLabels)\n\t\t\t\t\t.join(\"text\")\n\t\t\t\t\t.attr(\"x\", function(d) {return d.labelPos[0]})\n\t\t\t\t\t.attr(\"y\", function(d) {return d.labelPos[1]})\n\t\t\t\t\t.attr(\"dy\", margin*0.5)\n\t\t\t\t\t.attr(\"dx\", margin*1.8)\n\t\t\t\t\t.text(function(d) {return numFormat(d.value)})\n\t\t\t\t\t.style(\"display\", function(d, i) {return checks[i].is(\":checked\") ? \"block\" : \"none\" });\n\n\t\t\t\tif (labels.length > 4) g.append(\"text\")\n\t\t\t\t\t.attr(\"x\", screenWidth < smallBp ? xPos(0, index) : xPos(0, index) + margin)\n\t\t\t\t\t.attr(\"y\", yPos(null, index) + shift.y)\n\t\t\t\t\t.attr(\"dy\", -margin)\n\t\t\t\t\t.attr(\"dx\", margin)\n\t\t\t\t\t.text(ddata[index][labels[0]]);\n\n\t\t\t\tg.selectAll(\"image\")\n\t\t\t\t\t.data(hoverLabels)\n\t\t\t\t\t.join(\"image\")\n\t\t\t\t\t.attr(\"xlink:href\", function(d, i) {return icons[i]})\n\t\t\t\t\t.attr(\"width\", size)\n\t\t\t\t\t.attr(\"height\", size)\n\t\t\t\t\t.attr(\"x\", function(d) {return d.labelPos[0] + margin*0.5})\n\t\t\t\t\t.attr(\"y\", function(d) {return d.labelPos[1] - size*0.5})\n\t\t\t\t\t.style(\"display\", function(d, i) {return checks[i].is(\":checked\") ? \"block\" : \"none\" });\n\t\t\t\treturn g;\n\t\t\t}\n\n\t\t\tfunction checkBoxStates() {\n\t\t\t\tfor (var i = 0; i < checks.length; i++) {\n\t\t\t\t\tvar $elem = $(\".profile-feature\" + (i + 1));\n\t\t\t\t\tif (checks[i].is(\":checked\")) {\n\t\t\t\t\t\t$elem.fadeIn();\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$elem.fadeOut();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (!checks[0].is(\":checked\") && !checks[1].is(\":checked\") && !checks[2].is(\":checked\")) {$(\".main-label-ranks\").fadeIn()}\n\t\t\t\telse {$(\".main-label-ranks\").fadeOut()}\n\t\t\t}\n\n\t\t\tvar svg,\n\t\t\t\teditors,\n\t\t\t\tarticles,\n\t\t\t\tviews,\n\t\t\t\ttooltip,\n\t\t\t\tcontainer = d3.select(\"#\" + id),\n\t\t\t\tchecks = [$(\"#feature1\"), $(\"#feature2\"), $(\"#feature3\")],\n\t\t\t\taspect = width / height,\n\t\t\t\tmappedData = mappedViewsData(data),\n\t\t\t\tddata = mappedData.slice(dataStart, dataEnd),\n\t\t\t\tmaxRows = d3.max(mappedData, function(d) { return d.Rows }),\n\t\t\t\tunitR = 4,\n\t\t\t\teditorScale = d3.scaleLinear()\n\t\t\t\t\t.domain([0, d3.max(data, function(d) { return d[labels[1]] })])\n\t\t\t\t\t.range([0, maxFeature1]), //min and max radius of circle\n\t\t\t\tarticleScale = d3.scaleLinear()\n\t\t\t\t\t.domain([0, d3.max(data, function(d) { return d[labels[2]] })])\n\t\t\t\t\t.range([0, maxFeature2]), //min and max height of rect\n\t\t\t\tviewsUnitScale = d3.scaleLinear()\n\t\t\t\t\t.domain([0, masterunit])\n\t\t\t\t\t.range([0, unitR]), // min and max size of of 1 unit\n\t\t\t\tviewsYScale = d3.scaleLinear()\n\t\t\t\t\t.domain([0, maxRows])\n\t\t\t\t\t.range([0, maxRows * unitR * 2]), // min and max space for rows\n\t\t\t\tviewsXScale = d3.scaleLinear()\n\t\t\t\t\t.domain([0, horUnits])\n\t\t\t\t\t.range([0, horUnits * unitR * 2.5]), // min and max space for columns\n\t\t\t\tminHeight = editorScale.range()[1] * 2 + viewsYScale.range()[1] + (legendLabelDistance + margin) * 4;\n\n\t\t\theight = except && height < minHeight ? minHeight : height; // update\n\t\t\texceptHeightMulti = height/shift.y; // update\n\n\t\t\tsvg = container.append(\"svg\")\n\t\t\t\t.attr(\"width\", width)\n\t\t\t\t.attr(\"height\", height)\n\t\t\t\t.attr(\"perserveAspectRatio\", \"xMidYMid meet\")\n\t\t\t\t.attr(\"viewBox\", \"0 0 \" + width + \" \" + height);\n\n\t\t\t// lazy resize, keeps proportions\n\t\t\t$( window ).resize(function(){\n\t\t\t\tvar targetWidth = container.node().getBoundingClientRect().width;\n\t\t\t\tcontainer.selectAll(\"svg\").attr(\"width\", targetWidth);\n\t\t\t\tcontainer.selectAll(\"svg\").attr(\"height\", targetWidth / aspect);\n\t\t\t});\n\n\t\t\teditors = svg.append(\"g\").call(editorsConstruct);\n\t\t\tarticles = svg.append(\"g\").call(articlesConstruct, editors);\n\t\t\tviews = svg.append(\"g\").call(viewsConstruct, editors, articles);\n\n\t\t\tsvg.append(\"g\").call(labelConstruct, editors, dataStart);\n\t\t\tsvg.append(\"g\").call(borderleft);\n\n\t\t\tif (except) {\n\t\t\t\tsvg.append(\"g\").call(legendConstruct, editors, articles, views);\n\t\t\t} else {\n\t\t\t\ttooltip = svg\n\t\t\t\t\t.append(\"g\")\n\t\t\t\t\t.attr(\"class\", \"tooltip\");\n\n\t\t\t\tsvg\n\t\t\t\t\t.append(\"g\")\n\t\t\t\t\t.attr(\"opacity\", 0)\n\t\t\t\t\t.attr(\"class\", \"tooltipgrid\")\n\t\t\t\t\t.selectAll(\"rect\")\n\t\t\t\t\t.data(ddata)\n\t\t\t\t\t.join(\"rect\")\n\t\t\t\t\t.attr(\"class\", \"hover\")\n\t\t\t\t\t.attr(\"x\", function(d, i) {return xPos(d, i)})\n\t\t\t\t\t.attr(\"y\", function(d, i) {return yPos(d, i)})\n\t\t\t\t\t.attr(\"width\", shift.x)\n\t\t\t\t\t.attr(\"height\", shift.y)\n\t\t\t\t\t.on(\"touchstart mouseover\", function(_, i) {\n\t\t\t\t\t\tif (ddata[i][labels[0]] === exceptLang) return;\n\t\t\t\t\t\ttooltip\n\t\t\t\t\t\t\t.call(hover, i, editors, articles, views);\n\t\t\t\t\t})\n\t\t\t\t\t.on(\"touchend mouseout\", function() {tooltip.call(hover, null)});\n\n\t\t\t\t// applies to all, but only runs once\n\t\t\t\t$(\".chart-options input[type='checkbox']\").click(checkBoxStates);\n\t\t\t\tcheckBoxStates();\n\t\t\t}\n\t\t}\n\n\t\taddVis();\n\t}\n\n\t$(\".d3-dataprofiles\").each(function() {\n\t\tdataProfiles(this.id);\n\t});\n\n\n});\n/* global d3 */\n/* eslint-disable no-magic-numbers */\n\njQuery(document).ready(function($) {\n\n\t'use strict';\n\n\tfunction lineChart(id) {\n\t\tvar $id = $(\"#\" + id),\n\t\t\tmobileThresh = 762,\n\t\t\tisMobile = $(window).width() < mobileThresh,\n\t\t\tmargin = { top: 30, right: isMobile ? 20 : 60, bottom: 60, left: 40 },\n\t\t\torigWidth = $id.width(),\n\t\t\twidth = origWidth - margin.left - margin.right,\n\t\t\torigHeight = 300,\n\t\t\theight = origHeight - margin.top - margin.bottom,\n\t\t\tstrokeWidth = 1.5,\n\t\t\tcircleDiameter = 4,\n\t\t\taccentColorClass = $id.data(\"stroke-color\"),\n\t\t\ttimeFormatPrefs = $id.data(\"time-format\") === \"month\" ? { month: \"long\" } : { month: \"short\", day: \"numeric\", year: \"numeric\" },\n\t\t\tparseTimeFormat = d3.timeParse(\"%Y-%m-%d\"),\n\t\t\tdataRaw = $id.data(\"chart-raw\"),\n\t\t\tdata = dataRaw ? dataRaw.map(parseDates) : null;\n\n\t\tfunction parseDates(wp) {\n\t\t\twp.date = parseTimeFormat(wp.date);\n\t\t\treturn wp;\n\t\t}\n\n\t\tfunction callout(g, value, xPos, evnt) {\n\t\t\tif (!value) return g.style(\"display\", \"none\");\n\t\t\tg\n\t\t\t\t.attr(\"class\", \"tooltip\")\n\t\t\t\t.style(\"display\", null)\n\t\t\t\t.style(\"pointer-events\", \"none\");\n\n\t\t\tvar borderRadius = 2,\n\t\t\t\tlineHeight = 1.2,\n\t\t\t\trect = g.selectAll(\"rect\")\n\t\t\t\t\t.data([null])\n\t\t\t\t\t.join(\"rect\")\n\t\t\t\t\t.attr(\"rx\", borderRadius)\n\t\t\t\t\t.attr(\"ry\", borderRadius),\n\t\t\t\ttext = g.selectAll(\"text\")\n\t\t\t\t\t.data([null])\n\t\t\t\t\t.join(\"text\")\n\t\t\t\t\t.call(function(t) {\n\t\t\t\t\t\treturn t\n\t\t\t\t\t\t\t.selectAll(\"tspan\")\n\t\t\t\t\t\t\t.data(value.split(/\\n/))\n\t\t\t\t\t\t\t.join(\"tspan\")\n\t\t\t\t\t\t\t.attr(\"x\", 0)\n\t\t\t\t\t\t\t.attr(\"y\", function(d, i) { return i * lineHeight + \"em\" })\n\t\t\t\t\t\t\t.style(\"font-weight\", function(_, i) { return i ? null : \"bold\" })\n\t\t\t\t\t\t\t.text(function(d) { return d; })\n\t\t\t\t\t}),\n\t\t\t\tbbox = text.node().getBBox(),\n\t\t\t\tw = bbox.width,\n\t\t\t\th = bbox.height,\n\t\t\t\tttipMar = 10,\n\t\t\t\ttotalMar = ttipMar * 2,\n\t\t\t\tshift = 2;\n\n\t\t\tg.selectAll(\"circle\")\n\t\t\t\t.data([null])\n\t\t\t\t.join(\"circle\")\n\t\t\t\t.attr(\"r\", circleDiameter)\n\t\t\t\t.attr(\"stroke-width\", strokeWidth)\n\t\t\t\t.attr(\"fill\", evnt ? \"none\" : \"white\")\n\n\t\t\trect.attr(\"width\", w + totalMar).attr(\"height\", h + totalMar)\n\n\t\t\tif (xPos + w > width) {\n\t\t\t\ttext.attr(\"transform\", \"translate(\" + (-w - totalMar) + \",\" + -((h - totalMar) / 2 - shift) + \")\");\n\t\t\t\trect.attr(\"x\", -(w + ttipMar + totalMar)).attr(\"y\", -(h + totalMar) / 2);\n\t\t\t} else {\n\t\t\t\ttext.attr(\"transform\", \"translate(\" + totalMar + \",\" + -((h - totalMar) / 2 - shift) + \")\");\n\t\t\t\trect.attr(\"x\", ttipMar).attr(\"y\", -(h + totalMar) / 2);\n\t\t\t}\n\n\t\t\treturn g;\n\t\t}\n\n\t\tfunction addVis() {\n\t\t\tif (!data) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar svg,\n\t\t\t\tticks = { x: 0, y: 4 },\n\t\t\t\tx = d3.scaleTime()\n\t\t\t\t\t.nice()\n\t\t\t\t\t.domain(d3.extent(data, function(d) { return d.date; }))\n\t\t\t\t\t.range([0, width]),\n\t\t\t\txAxis = function(g) {\n\t\t\t\t\tg\n\t\t\t\t\t\t.attr(\"transform\", \"translate(0,\" + height + \")\")\n\t\t\t\t\t\t.call(d3.axisBottom(x)\n\t\t\t\t\t\t\t.ticks(d3.timeMonth, 1)\n\t\t\t\t\t\t\t.tickFormat(isMobile ? d3.timeFormat(\"%b\") : d3.timeFormat(\"%B\")))\n\t\t\t\t\t\t.call(function(h) { h.select(\".domain\").remove(); })\n\t\t\t\t},\n\t\t\t\ty = d3.scaleLinear()\n\t\t\t\t\t.domain([0, d3.max(data, function(d) { return d.value; })])\n\t\t\t\t\t.range([height, 0]),\n\t\t\t\tyAxis = function(g) {\n\t\t\t\t\tg\n\t\t\t\t\t\t.attr(\"class\", \"yAxis\")\n\t\t\t\t\t\t.call(d3.axisLeft(y)\n\t\t\t\t\t\t\t.ticks(ticks.y)\n\t\t\t\t\t\t\t.tickFormat(d3.format(\".2s\"))\n\t\t\t\t\t\t\t.tickSize(-1 * width))\n\t\t\t\t\t\t.call(function(h) { h.select(\".domain\").remove(); })\n\t\t\t\t},\n\t\t\t\tbisectDate = function(mx) {\n\t\t\t\t\tvar bisect = d3.bisector(function(d) { return d.date }).left,\n\t\t\t\t\t\tdate = x.invert(mx),\n\t\t\t\t\t\tindex = bisect(data, date, 1),\n\t\t\t\t\t\ta = data[index - 1],\n\t\t\t\t\t\tb = data[index];\n\t\t\t\t\treturn date - a.date > b.date - date ? b : a;\n\t\t\t\t},\n\t\t\t\ttooltip,\n\t\t\t\tcontainer = d3.select(\"#\" + id),\n\t\t\t\taspect = origWidth / origHeight;\n\n\t\t\tsvg = container.append(\"svg\")\n\t\t\t\t.attr(\"width\", origWidth)\n\t\t\t\t.attr(\"height\", origHeight)\n\t\t\t\t.attr(\"perserveAspectRatio\", \"xMidYMid meet\")\n\t\t\t\t.attr(\"viewBox\", \"0 0 \" + origWidth + \" \" + origHeight)\n\t\t\t\t.append(\"g\")\n\t\t\t\t.attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");\n\n\t\t\t// lazy resize, keeps proportions\n\t\t\t$( window ).resize(function() {\n\t\t\t\tvar targetWidth = container.node().getBoundingClientRect().width;\n\t\t\t\tcontainer.selectAll(\"svg\").attr(\"width\", targetWidth);\n\t\t\t\tcontainer.selectAll(\"svg\").attr(\"height\", targetWidth / aspect);\n\t\t\t});\n\n\t\t\tsvg.append(\"g\").call(xAxis);\n\t\t\tsvg.append(\"g\").call(yAxis);\n\n\t\t\tsvg.append(\"path\")\n\t\t\t\t.datum(data)\n\t\t\t\t.attr(\"fill\", \"none\")\n\t\t\t\t.attr(\"stroke-width\", strokeWidth)\n\t\t\t\t.attr(\"stroke\", \"black\")\n\t\t\t\t.attr(\"class\", \"line \" + accentColorClass)\n\t\t\t\t.attr(\"d\", d3.line()\n\t\t\t\t\t.x(function(d) { return x(d.date) })\n\t\t\t\t\t.y(function(d) { return y(d.value) })\n\t\t\t\t);\n\n\t\t\tsvg.append(\"g\")\n\t\t\t\t.selectAll(\"circle\")\n\t\t\t\t.data(data.filter(function(d) { return d.event; }))\n\t\t\t\t.enter(\"circle\")\n\t\t\t\t.append(\"circle\")\n\t\t\t\t.attr(\"class\", \"circle \" + accentColorClass)\n\t\t\t\t.attr(\"r\", circleDiameter)\n\t\t\t\t.attr(\"cx\", function(d) { return x(d.date); })\n\t\t\t\t.attr(\"cy\", function(d) { return y(d.value); });\n\n\t\t\ttooltip = svg.append(\"g\");\n\n\t\t\tsvg.append('rect')\n\t\t\t\t.attr(\"class\", \"overlay\")\n\t\t\t\t.attr(\"pointer-events\", \"all\")\n\t\t\t\t.attr('x', 0)\n\t\t\t\t.attr('y', 0)\n\t\t\t\t.attr('width', width)\n\t\t\t\t.attr('height', height)\n\t\t\t\t.on(\"touchmove mousemove\", function() {\n\t\t\t\t\tvar hoverD = bisectDate(d3.mouse(this)[0]),\n\t\t\t\t\t\tcontext = hoverD.date.toLocaleString(undefined, timeFormatPrefs) + \"\\n\" + d3.format(\",\")(hoverD.value);\n\t\t\t\t\ttooltip\n\t\t\t\t\t\t.attr(\"transform\", \"translate(\" + x(hoverD.date) + \",\" + y(hoverD.value) + \")\")\n\t\t\t\t\t\t.call(callout, context, x(hoverD.date), hoverD.event);\n\t\t\t\t\tif (hoverD.event) {\n\t\t\t\t\t\t$(\"#label-date\").text(hoverD.date.toLocaleString(undefined, timeFormatPrefs));\n\t\t\t\t\t\t$(\"#label-name\").text(hoverD.event);\n\t\t\t\t\t\t$(\"#linechart-label\").css(\"opacity\", 1);\n\t\t\t\t\t\t$(\"#linechart-label\").css(\"max-height\", 10 + \"rem\");\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$(\"#linechart-label\").css(\"opacity\", 0);\n\t\t\t\t\t\t$(\"#linechart-label\").css(\"max-height\", 2 + \"rem\");\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.on(\"touchend mouseleave\", function() {\n\t\t\t\t\ttooltip.call(callout, null);\n\t\t\t\t});\n\t\t}\n\n\t\taddVis();\n\n\t}\n\n\t$(\".d3-linechart\").each(function() {\n\t\tlineChart(this.id);\n\t});\n\n\n});"]}