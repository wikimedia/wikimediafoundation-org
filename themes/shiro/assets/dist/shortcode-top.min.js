jQuery(document).ready(function(w){"use strict";var k,x,y=topAtts,n=w("#"+y.id),t=w("#year-select"),_=n.find(".no-data"),i=w(".top-data-content"),b=w(".article-photo-credits-container"),a={edits:[],views:[]};function r(o,e){var f="views"===e?"wiki":"wiki_db",u=o.map(function(e){return e[f]}),h=y[e+"_label"],g="views"===e?"pageviews":"edits",v="views"===e?"daily_views":"daily_edits",m=[];b.find(".article-photo-credits").text(""),b.hide(),i.each(function(){var e=w(this),t=w(this).attr("id"),i=o.find(function(e){return e[f]===t}),n="";if(_.hide(),e.hide(),-1<u.indexOf(t)){var a=i["desc_"+y.lang.replace("wiki","")].replace(/"/g,""),r=i.pagetitle.replace(/_/g," "),d=i.file_name.replace("File:",""),c=y.directory+d.replace(".svg",".png").replace(".JPG",".jpg"),s=d3.format(",")(i[g]),l=i[v].split("_").map(function(e){return parseInt(e,10)}),p="#"+t+"-graph";w(p).empty(),function(e,t){var i,n;i=d3.scaleLinear().domain([0,d3.max(e,function(e){return e})]).nice().range([40,6]),n=d3.scaleLinear().domain([0,e.length]).range([0,300]),k=d3.line().defined(function(e){return!isNaN(e)}).curve(d3.curveBasis).x(function(e,t){return n(t)}).y(function(e){return i(e)}),(x=d3.select(t).append("svg").attr("viewBox",[0,0,300,46])).append("g").attr("class","bg-line-graph").append("line").style("stroke","#c8ccd1").attr("x1",0).attr("x2",300).attr("y1",40).attr("y2",40),x.append("g").attr("class","line-graph").append("path").datum(e).attr("fill","none").attr("stroke","#72777D").attr("stroke-width",1.5).attr("stroke-linejoin","round").attr("stroke-linecap","round").attr("d",k)}(l,p),e.find(".heading").text(r),e.find(".desc").text(a),i[f].replace("wiki","").match(/^[a-zA-Z\-]{2,16}$/)&&e.find(".details").attr("href","https://"+i[f].replace("wiki","")+".wikipedia.org/wiki/"+i.pagetitle).attr("target","_blank"),e.find(".data span").text(s+" "+h),0<d.length&&0<c.length?(e.find(".article-image").removeClass("article-image-fallback").css("background-image",'url("'+c+'")'),e.find(".article-image-link").attr("href",i.image_page),-1===m.indexOf(d)&&(m.push(d),n+=0<i.artist.length?", "+i.artist:"",n+=0<i.license.length?", "+i.license:"",b.find(".article-photo-credits").append(w("<div></div>").append(w("<a>").text(d).attr("href",i.image_page)).append(w("<span></span>").text(n))))):(e.find(".article-image-link > div").unwrap(),e.find(".article-image").attr("style","").addClass("article-image-fallback")),e.fadeIn(),b.show()}else _.show()})}function d(){var e=n.find("input:checked").val();0<a[e].length?c(e):function(e){var t="";"edits"===e?(t=-1<y.url_edits.indexOf(".csv")?y.url_edits:"",d3.csv(t,function(e){return e}).then(function(e){a.edits=e,d()})):(t=-1<y.url_views.indexOf(".csv")?y.url_views:"",d3.csv(t,function(e){return e}).then(function(e){a.views=e,d()}))}(e),t.find("option").each(function(){var t=parseInt(w(this).val(),10);0<a[e].filter(function(e){return parseInt(e.year,10)===t}).length?w(this).removeAttr("disabled"):w(this).attr("disabled","true")})}function c(e){var t="",i="string"==typeof e?e:n.find("input:checked").val();w("#year-select option:selected").each(function(){t+=w(this).text()+" "}),r(a[i].filter(function(e){return parseInt(e.year,10)===parseInt(t,10)}),i)}i.each(function(){w(this).hide()}),d(),t.change(c),n.find("input").change(d)});