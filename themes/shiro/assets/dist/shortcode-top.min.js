jQuery(document).ready(function(x){"use strict";var y,_,b=topAtts,a=x("#"+b.id),t=x("#year-select"),I=a.find(".no-data"),i=x(".top-data-content"),O=x(".article-photo-credits-container"),n={edits:[],views:[]};function r(u,e){var h="views"===e?"wiki":"wiki_db",g=u.map(function(e){return e[h]}),v=b[e+"_label"],m="views"===e?"pageviews":"edits",w="views"===e?"daily_views":"daily_edits",k=[];O.find(".article-photo-credits").text(""),O.hide(),i.each(function(){var e,t,i,a,n,r,d,c,s,l=x(this),p=x(this).attr("id"),o=u.find(function(e){return e[h]===p}),f="";I.hide(),l.hide(),-1<g.indexOf(p)?(e=o["desc_"+b.lang.replace("wiki","")].replace(/"/g,""),t=o.pagetitle.replace(/_/g," "),i=o.file_name.replace("File:",""),a=b.directory+i.replace(".svg",".png").replace(".JPG",".jpg"),n=d3.format(",")(o[m]),r=o[w].split("_").map(function(e){return parseInt(e,10)}),x(d="#"+p+"-graph").empty(),r=r,d=d,c=d3.scaleLinear().domain([0,d3.max(r,function(e){return e})]).nice().range([40,6]),s=d3.scaleLinear().domain([0,r.length]).range([0,300]),y=d3.line().defined(function(e){return!isNaN(e)}).curve(d3.curveBasis).x(function(e,t){return s(t)}).y(function(e){return c(e)}),(_=d3.select(d).append("svg").attr("viewBox",[0,0,300,46])).append("g").attr("class","bg-line-graph").append("line").style("stroke","#c8ccd1").attr("x1",0).attr("x2",300).attr("y1",40).attr("y2",40),_.append("g").attr("class","line-graph").append("path").datum(r).attr("fill","none").attr("stroke","#72777D").attr("stroke-width",1.5).attr("stroke-linejoin","round").attr("stroke-linecap","round").attr("d",y),l.find(".heading").text(t),l.find(".desc").text(e),o[h].replace("wiki","").match(/^[a-zA-Z\-]{2,16}$/)&&l.find(".details").attr("href","https://"+o[h].replace("wiki","")+".wikipedia.org/wiki/"+o.pagetitle).attr("target","_blank"),l.find(".data span").text(n+" "+v),0<i.length&&0<a.length?(l.find(".article-image").removeClass("article-image-fallback").css("background-image",'url("'+a+'")'),l.find(".article-image-link").attr("href",o.image_page),-1===k.indexOf(i)&&(k.push(i),f=(f+=0<o.artist.length?", "+o.artist:"")+(0<o.license.length?", "+o.license:""),O.find(".article-photo-credits").append(x("<div></div>").append(x("<a>").text(i).attr("href",o.image_page)).append(x("<span></span>").text(f))))):(l.find(".article-image-link > div").unwrap(),l.find(".article-image").attr("style","").addClass("article-image-fallback")),l.fadeIn(),O.show()):I.show()})}function d(){var e,i=a.find("input:checked").val();0<n[i].length?c(i):(e="","edits"===i?(e=-1<b.url_edits.indexOf(".csv")?b.url_edits:"",d3.csv(e,function(e){return e}).then(function(e){n.edits=e,d()})):(e=-1<b.url_views.indexOf(".csv")?b.url_views:"",d3.csv(e,function(e){return e}).then(function(e){n.views=e,d()}))),t.find("option").each(function(){var t=parseInt(x(this).val(),10);0<n[i].filter(function(e){return parseInt(e.year,10)===t}).length?x(this).removeAttr("disabled"):x(this).attr("disabled","true")})}function c(e){var t="",e="string"==typeof e?e:a.find("input:checked").val();x("#year-select option:selected").each(function(){t+=x(this).text()+" "}),r(n[e].filter(function(e){return parseInt(e.year,10)===parseInt(t,10)}),e)}i.each(function(){x(this).hide()}),d(),t.change(c),a.find("input").change(d)});